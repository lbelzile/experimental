<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Experimental Designs and Statistical Methods - Linear mixed models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Experimental Designs and Statistical Methods</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../content/index.html" rel="" target="">
 <span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../evaluations/index.html" rel="" target="">
 <span class="menu-text">Evaluations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../example/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Examples</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://lbelzile.github.io/math80667a" rel="" target="">
 <span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://lbelzile.github.io/hecedsm" rel="" target=""><i class="bi bi-box" role="img" aria-label="Datasets">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../example/introduction.html">Examples</a></li><li class="breadcrumb-item"><a href="../example/mixedmodel.html">Linear mixed models</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>R</strong> and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/SPSS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SPSS</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/onewayanova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">One-way ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/twowayanova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Two-way ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/threewayanova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Three-way ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis of covariance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/effectsizepower.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Effect size and power</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/repeated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Repeated measures ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/manova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/mixedmodel.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Linear mixed models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/linearmediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear causal mediation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/nonparametric.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonparametric tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/counts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Count data</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#example-1" id="toc-example-1" class="nav-link active" data-scroll-target="#example-1">Example 1</a>
  <ul class="collapse">
  <li><a href="#determining-model-structure" id="toc-determining-model-structure" class="nav-link" data-scroll-target="#determining-model-structure">Determining model structure</a></li>
  <li><a href="#model-formulation" id="toc-model-formulation" class="nav-link" data-scroll-target="#model-formulation">Model formulation</a></li>
  <li><a href="#correlation-structure" id="toc-correlation-structure" class="nav-link" data-scroll-target="#correlation-structure">Correlation structure</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing">Testing</a></li>
  <li><a href="#pairwise-comparisons" id="toc-pairwise-comparisons" class="nav-link" data-scroll-target="#pairwise-comparisons">Pairwise comparisons</a></li>
  <li><a href="#checking-model-assumptions" id="toc-checking-model-assumptions" class="nav-link" data-scroll-target="#checking-model-assumptions">Checking model assumptions</a></li>
  </ul></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example 2</a>
  <ul class="collapse">
  <li><a href="#model-structure" id="toc-model-structure" class="nav-link" data-scroll-target="#model-structure">Model structure</a></li>
  <li><a href="#model-fitting-and-tests" id="toc-model-fitting-and-tests" class="nav-link" data-scroll-target="#model-fitting-and-tests">Model fitting and tests</a></li>
  </ul></li>
  <li><a href="#example-3" id="toc-example-3" class="nav-link" data-scroll-target="#example-3">Example 3</a>
  <ul class="collapse">
  <li><a href="#model-structure-1" id="toc-model-structure-1" class="nav-link" data-scroll-target="#model-structure-1">Model structure</a></li>
  <li><a href="#model-adjustment-and-testing" id="toc-model-adjustment-and-testing" class="nav-link" data-scroll-target="#model-adjustment-and-testing">Model adjustment and testing</a></li>
  <li><a href="#model-assumptions" id="toc-model-assumptions" class="nav-link" data-scroll-target="#model-assumptions">Model assumptions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Linear mixed models</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The following examples serves to illustrate the structure of experimental designs with both crossed and nested effects. The models are fitted specifying both random and fixed effects. We use the <strong>R</strong> package <code>lme4</code> to estimate the coefficients of the resulting linear mixed effect model and <code>lmerTest</code> for additional testing features.</p>
<p>A word of caution: correctly formulating mixed models for complex experimental designs is far from trivial, and the correct interpretation of the output requires subject-matter expertise. Thus, rather than see the following sections as a definitive guide to doing such calculations on your own, it should be viewed as a way to acquire some terminology and intuition for speaking with a statistical consultant and formulating your needs, and gain familiarity for peer-reviewing purposes.</p>
<section id="example-1" class="level1">
<h1>Example 1</h1>
<p>We consider data from Danish company of electronics Bang and Olufsen from the <code>lmerTest</code> package (under <code>data(TVbo)</code>). The setup of the experiment is as follows: eight experienced raters (<code>Assessor</code>) were asked to rate 15 characteristics of televisions to compare two attributes, <code>Picture</code> and <code>TVset</code>.</p>
<section id="determining-model-structure" class="level2">
<h2 class="anchored" data-anchor-id="determining-model-structure">Determining model structure</h2>
<p>Based on this description alone, it is somewhat unclear what the structure of the experiment is. We can inspect the database.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(TVbo)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(TVbo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   192 obs. of  19 variables:
 $ Assessor            : Factor w/ 8 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ TVset               : Factor w/ 3 levels "TV1","TV2","TV3": 3 2 1 3 2 1 3 2 1 3 ...
 $ Repeat              : Factor w/ 2 levels "0","1": 1 1 1 2 2 2 1 1 1 2 ...
 $ Picture             : Factor w/ 4 levels "1","2","3","4": 1 1 1 1 1 1 2 2 2 2 ...
 $ Coloursaturation    : num  10.4 9.9 7 9.8 10.6 7.5 7.1 9.9 5 10 ...
 $ Colourbalance       : num  5 4.1 9.8 4.8 4.3 9.4 8 7.5 6.4 7.5 ...
 $ Noise               : num  13.1 10.9 13.1 13.2 13.3 13.3 12 8.7 12.8 13.4 ...
 $ Depth               : num  3.1 7.4 6 5.7 6.7 5.8 8.2 6.3 3.9 8.3 ...
 $ Sharpness           : num  8.3 5.3 7.9 9.3 4.7 6.6 10.7 7.5 6 8.8 ...
 $ Lightlevel          : num  9.5 9.9 6.9 9.8 10.3 6.7 10.3 9.5 5.8 9.2 ...
 $ Contrast            : num  6.4 6.9 5.9 6.3 7.5 6.4 9.1 7 4.1 9.8 ...
 $ Sharpnessofmovement : num  11.6 11.6 11.5 8.1 8.1 8.1 4 8.1 5.1 4.5 ...
 $ Flickeringstationary: num  13.5 13.5 13.5 12.1 8.8 13.2 12.1 5.6 11.8 13.5 ...
 $ Flickeringmovement  : num  2 1.8 1.7 13.5 13.5 13.5 1.9 1.8 1.7 13.5 ...
 $ Distortion          : num  1.8 1.9 1.9 1.5 1.5 1.5 1.8 2 1.9 1.4 ...
 $ Dimglasseffect      : num  1.6 1.6 1.6 1.7 1.7 1.7 1.6 1.6 1.5 1.7 ...
 $ Cutting             : num  1.5 2.2 3.3 1.4 3.9 3.7 1.5 2.7 4.1 1.6 ...
 $ Flossyedges         : num  3.4 3.3 5.4 7.9 4.4 4.6 9.9 3.1 4.5 11.6 ...
 $ Elasticeffect       : num  4.9 2.7 1.7 4.4 2.8 1.7 4.2 2.3 1.7 4.9 ...</code></pre>
</div>
</div>
<p>We have three factors for the model: <code>Assessor</code>, <code>TVset</code> and <code>Picture</code>. There are seemingly two repetitions for ratings based on the factor level. Let us investigate the two manipulated factors, <code>TVset</code> and <code>Picture</code>, and look at the number of occurences for each combination</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> TVset <span class="sc">+</span> Picture, <span class="at">data =</span> TVbo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Picture
TVset  1  2  3  4
  TV1 16 16 16 16
  TV2 16 16 16 16
  TV3 16 16 16 16</code></pre>
</div>
</div>
<p>There are 16 measurements for each combination, something compatible with a repeated measure design in which each of the eight assessor gets to see all factors. Thus, <code>Picture</code> and <code>TVset</code> are crossed within-subject factors and the dataset is balanced. The contingency table shows that we can estimate interactions between <code>TVset</code> and <code>Picture</code>. Since we are not interested in individual assessors scores, we treat the factor as a random effect and any interaction with <code>Assessor</code> will also be treated as random.</p>
<p>Given that we have two replications per combination of <code>TVset</code> and <code>Picture</code>, we could in theory fit the three-way (random) effect by including the term <code>(1 | Assessor:TVset:Picture)</code>. If we do so, the software gives a warning: <code>boundary (singular) fit</code> which indicates an estimated variance is exactly zero, a synonym in this example for overfitting. We thus remove the three-way interaction. However, the numerical routine fails to converge, showing zero estimated variance for <code>Assessor:Picture</code>. Thus, we refit the model without the three-way interaction (since it does not make sense to have a three-way interaction, but remove one of the two-way), and later refit another model without <code>Assessor:Picture</code> whose variability is still estimated to be zero. Sometimes, this may be due to poor starting value and we may try to change the default optimization algorithm, the problem persist.</p>
</section>
<section id="model-formulation" class="level2">
<h2 class="anchored" data-anchor-id="model-formulation">Model formulation</h2>
<p>Since there are 15 different response variables, we start with a single one, here <code>Sharpness</code> of the display. The model we fit is of the form</p>
<p><span class="math display">\[\begin{align*}
Y_{ijkl} = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \gamma_k + (\beta\gamma)_{jk} + \varepsilon_{ijkl},
\end{align*}\]</span> where</p>
<ul>
<li><span class="math inline">\(Y_{ijkl}\)</span> is the <code>Sharpness</code> rating for the <span class="math inline">\(i\)</span>th <code>TVset</code>, the <span class="math inline">\(j\)</span>th <code>Picture</code>, the <span class="math inline">\(k\)</span>th assessor and the <span class="math inline">\(l\)</span>th replication.</li>
<li><span class="math inline">\(\mu\)</span> is the global average of all ratings</li>
<li><span class="math inline">\(\alpha_i\)</span> is the mean different for the <span class="math inline">\(i\)</span>th <code>TVset</code></li>
<li><span class="math inline">\(\beta_j\)</span> is the mean different for the <span class="math inline">\(j\)</span>th <code>Picture</code></li>
<li><span class="math inline">\((\alpha\beta)_{ij}\)</span> is the interaction for the <span class="math inline">\(i\)</span>th <code>TVset</code> and <span class="math inline">\(j\)</span>th <code>Picture</code>.</li>
<li><span class="math inline">\(\gamma_k \sim \mathsf{No}(0, \sigma^2_\gamma)\)</span> is the random effect of assessors</li>
<li><span class="math inline">\((\alpha\gamma)_{ik} \sim \mathsf{No}(0, \sigma^2_{\alpha\gamma})\)</span> are random effects for assessors for television sets</li>
<li><span class="math inline">\(\varepsilon_{ijkl} \sim \mathsf{No}(0, \sigma^2_\varepsilon)\)</span> are measurements-specific error terms</li>
</ul>
<p>All of the random effects, including error, are independent of one another.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  Sharpness <span class="sc">~</span> TVset <span class="sc">*</span> Picture <span class="sc">+</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>       (<span class="dv">1</span> <span class="sc">|</span> Assessor) <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>       <span class="co"># (1 | Assessor:Picture) +</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>       <span class="co"># (1 | Assessor:TVset:Picture) +</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>       (<span class="dv">1</span> <span class="sc">|</span> Assessor<span class="sc">:</span>TVset) ,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># control = lmerControl(optimizer = "bobyqa"),</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 'control' above for the optimization routine</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> TVbo)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mmod)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="correlation-structure" class="level2">
<h2 class="anchored" data-anchor-id="correlation-structure">Correlation structure</h2>
<p>The first section of the summary table gives estimations of the standard deviation of each error term. There is little variability due to <code>Assessor:Picture</code> interaction. The most important part of this output is perhaps to look at the number of instances to make sure our design specification is correct. The model assumes (correctly) that there are 32 combinations of <code>Assessor</code> and <code>Picture</code> (8 by 4), 24 combinations of <code>Assessor</code> and <code>TVset</code> (8 by 3) and 8 combinations for <code>Assessor</code>.</p>
<pre><code>Random effects:
 Groups         Name        Variance Std.Dev.
 Assessor:TVset (Intercept) 0.4909   0.7006  
 Assessor       (Intercept) 1.0837   1.0410  
 Residual                   1.9366   1.3916  
Number of obs: 192, groups:  
Assessor:TVset, 24; Assessor, 8</code></pre>
<p>One of the main reason for using mixed models is to automatically account for the correlation between observations. If we fail to account for the dependence between ratings from the same assessor and their personal preferences, we will get standard errors for the estimated mean difference for the two fixed effect that are <strong>too small</strong>. Another popular option in finance and economics is use of so-called sandwich variance estimators to handle unequal variance and clustering. Among other, the <a href="https://doi.org/10.18637/jss.v095.i01"><code>sandwich</code></a> package in <strong>R</strong> <span class="citation" data-cites="sandwich:2020">(<a href="#ref-sandwich:2020" role="doc-biblioref">Zeileis et al., 2020</a>)</span> offers multiple options should one decide on this avenue.</p>
<p><a href="#fig-tvbocorr">Figure&nbsp;1</a> shows the structure of the correlation matrix of the ratings: the blocks corresponds to the eight assessors: measurements from different assessors are independent, but they are correlated within assessors as a result of specifying (multiple) random effects with assessors. Since there is more than one source of variability here, the pattern is different from equicorrelation, with additional correlations between if data are from the same TV set or same picture level.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-tvbocorr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mixedmodel_files/figure-html/fig-tvbocorr-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Correlation structure for the linear mixed model fitted to the <code>TVbo</code> data</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="testing" class="level2">
<h2 class="anchored" data-anchor-id="testing">Testing</h2>
<p>Before looking more in details at the output, let us see if the rating depends on the setting (<code>TVset</code> and <code>Picture</code> combination): if it did, we would have to basically compare all 12 combinations as a one-way analysis of variance model. In this context, the logical comparison would be to compute pairwise differences and check which are equivalent to the best combination.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mmod, <span class="at">ddf =</span> <span class="st">"Kenward-Roger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Type III Analysis of Variance Table with Kenward-Roger's method
               Sum Sq Mean Sq NumDF DenDF F value    Pr(&gt;F)    
TVset          90.869  45.435     2    14 23.4615 3.384e-05 ***
Picture        26.304   8.768     3   159  4.5276  0.004478 ** 
TVset:Picture 105.183  17.531     6   159  9.0524 1.634e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>It is clear that there are differences all across the board. Constructing tests for mixed models in general is complicated and we need to correctly set up the model and compare the variability of the differences relative to the mean for each factor relative to different measures of variability. These will be the next random term that includes this factor and random effects (here either <code>Assessor</code> or the <code>Error</code> term). The correct source of variability are <code>Assessor:TVset</code> for <code>TVset</code>, <code>Assessor:Picture</code> for <code>Picture</code> and the error term for the two-way interaction between both fixed effects. Likewise, the degrees of freedom for the denominator are determined by the number of instances of the random term that involves the factor, so <span class="math inline">\(8 \times 3 - (1 - 2 - 7) = 14\)</span> degrees of freedom since there are 24 instances of <code>TVset:Assessor</code> and we have to estimate one grand mean, two mean differences for <code>TVset</code> and likewise 7 effects for the <code>Assessor</code>.</p>
<p>This decomposition is better seen looking directly at the model output when fitted using <code>aov</code> (since this is a balanced within-subject design).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  Coloursaturation <span class="sc">~</span> TVset <span class="sc">*</span> Picture <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Error</span>(Assessor<span class="sc">/</span>(Picture<span class="sc">*</span>TVset)), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> TVbo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pairwise-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="pairwise-comparisons">Pairwise comparisons</h2>
<p>We can next look at the estimated marginal means to find the television sets and the picture with the best ratings.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> mmod <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">emmeans</span>(<span class="at">spec =</span> <span class="fu">c</span>(<span class="st">"TVset"</span>,<span class="st">"Picture"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>All four best ratings are for TV set 2, with picture 4, 1, 2 and 3 (in decreasing order). We can see if these differences are significant by looking at all pairwise differences between combinations to find the best value. All of the differences in rating for TV set 2 could be attributed to noise after correcting for multiple testing using Tukey’s correction. The fifth top position is TV set 1, picture 4 and this one has a significantly lower rating (adjusted <span class="math inline">\(p\)</span>-value of 0.0088) than the leading choice.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>emm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> TVset Picture emmean    SE   df lower.CL upper.CL
 TV1   1         8.01 0.564 23.7     6.85     9.18
 TV2   1         6.92 0.564 23.7     5.75     8.08
 TV3   1        10.38 0.564 23.7     9.22    11.55
 TV1   2         6.97 0.564 23.7     5.81     8.14
 TV2   2         8.18 0.564 23.7     7.02     9.35
 TV3   2        11.39 0.564 23.7    10.23    12.56
 TV1   3         8.27 0.564 23.7     7.10     9.43
 TV2   3         7.57 0.564 23.7     6.40     8.73
 TV3   3         8.30 0.564 23.7     7.14     9.46
 TV1   4         8.82 0.564 23.7     7.65     9.98
 TV2   4         7.25 0.564 23.7     6.09     8.41
 TV3   4        10.91 0.564 23.7     9.74    12.07

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>emm <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                    estimate    SE    df t.ratio p.value
 TV1 Picture1 - TV2 Picture1   1.0938 0.604  51.1   1.811  0.8045
 TV1 Picture1 - TV3 Picture1  -2.3687 0.604  51.1  -3.922  0.0126
 TV1 Picture1 - TV1 Picture2   1.0375 0.492 159.0   2.109  0.6174
 TV1 Picture1 - TV2 Picture2  -0.1688 0.604  51.1  -0.279  1.0000
 TV1 Picture1 - TV3 Picture2  -3.3813 0.604  51.1  -5.598  0.0001
 TV1 Picture1 - TV1 Picture3  -0.2562 0.492 159.0  -0.521  1.0000
 TV1 Picture1 - TV2 Picture3   0.4437 0.604  51.1   0.735  0.9998
 TV1 Picture1 - TV3 Picture3  -0.2875 0.604  51.1  -0.476  1.0000
 TV1 Picture1 - TV1 Picture4  -0.8063 0.492 159.0  -1.639  0.8920
 TV1 Picture1 - TV2 Picture4   0.7625 0.604  51.1   1.262  0.9803
 TV1 Picture1 - TV3 Picture4  -2.8937 0.604  51.1  -4.791  0.0008
 TV2 Picture1 - TV3 Picture1  -3.4625 0.604  51.1  -5.733  &lt;.0001
 TV2 Picture1 - TV1 Picture2  -0.0563 0.604  51.1  -0.093  1.0000
 TV2 Picture1 - TV2 Picture2  -1.2625 0.492 159.0  -2.566  0.3081
 TV2 Picture1 - TV3 Picture2  -4.4750 0.604  51.1  -7.409  &lt;.0001
 TV2 Picture1 - TV1 Picture3  -1.3500 0.604  51.1  -2.235  0.5333
 TV2 Picture1 - TV2 Picture3  -0.6500 0.492 159.0  -1.321  0.9752
 TV2 Picture1 - TV3 Picture3  -1.3813 0.604  51.1  -2.287  0.4985
 TV2 Picture1 - TV1 Picture4  -1.9000 0.604  51.1  -3.146  0.0993
 TV2 Picture1 - TV2 Picture4  -0.3312 0.492 159.0  -0.673  0.9999
 TV2 Picture1 - TV3 Picture4  -3.9875 0.604  51.1  -6.602  &lt;.0001
 TV3 Picture1 - TV1 Picture2   3.4062 0.604  51.1   5.640  &lt;.0001
 TV3 Picture1 - TV2 Picture2   2.2000 0.604  51.1   3.643  0.0279
 TV3 Picture1 - TV3 Picture2  -1.0125 0.492 159.0  -2.058  0.6531
 TV3 Picture1 - TV1 Picture3   2.1125 0.604  51.1   3.498  0.0412
 TV3 Picture1 - TV2 Picture3   2.8125 0.604  51.1   4.657  0.0013
 TV3 Picture1 - TV3 Picture3   2.0812 0.492 159.0   4.230  0.0023
 TV3 Picture1 - TV1 Picture4   1.5625 0.604  51.1   2.587  0.3137
 TV3 Picture1 - TV2 Picture4   3.1313 0.604  51.1   5.184  0.0002
 TV3 Picture1 - TV3 Picture4  -0.5250 0.492 159.0  -1.067  0.9956
 TV1 Picture2 - TV2 Picture2  -1.2063 0.604  51.1  -1.997  0.6930
 TV1 Picture2 - TV3 Picture2  -4.4188 0.604  51.1  -7.316  &lt;.0001
 TV1 Picture2 - TV1 Picture3  -1.2937 0.492 159.0  -2.630  0.2725
 TV1 Picture2 - TV2 Picture3  -0.5938 0.604  51.1  -0.983  0.9975
 TV1 Picture2 - TV3 Picture3  -1.3250 0.604  51.1  -2.194  0.5614
 TV1 Picture2 - TV1 Picture4  -1.8438 0.492 159.0  -3.747  0.0129
 TV1 Picture2 - TV2 Picture4  -0.2750 0.604  51.1  -0.455  1.0000
 TV1 Picture2 - TV3 Picture4  -3.9312 0.604  51.1  -6.509  &lt;.0001
 TV2 Picture2 - TV3 Picture2  -3.2125 0.604  51.1  -5.319  0.0001
 TV2 Picture2 - TV1 Picture3  -0.0875 0.604  51.1  -0.145  1.0000
 TV2 Picture2 - TV2 Picture3   0.6125 0.492 159.0   1.245  0.9843
 TV2 Picture2 - TV3 Picture3  -0.1187 0.604  51.1  -0.197  1.0000
 TV2 Picture2 - TV1 Picture4  -0.6375 0.604  51.1  -1.056  0.9953
 TV2 Picture2 - TV2 Picture4   0.9313 0.492 159.0   1.893  0.7620
 TV2 Picture2 - TV3 Picture4  -2.7250 0.604  51.1  -4.512  0.0020
 TV3 Picture2 - TV1 Picture3   3.1250 0.604  51.1   5.174  0.0002
 TV3 Picture2 - TV2 Picture3   3.8250 0.604  51.1   6.333  &lt;.0001
 TV3 Picture2 - TV3 Picture3   3.0938 0.492 159.0   6.288  &lt;.0001
 TV3 Picture2 - TV1 Picture4   2.5750 0.604  51.1   4.263  0.0045
 TV3 Picture2 - TV2 Picture4   4.1437 0.604  51.1   6.861  &lt;.0001
 TV3 Picture2 - TV3 Picture4   0.4875 0.492 159.0   0.991  0.9977
 TV1 Picture3 - TV2 Picture3   0.7000 0.604  51.1   1.159  0.9898
 TV1 Picture3 - TV3 Picture3  -0.0312 0.604  51.1  -0.052  1.0000
 TV1 Picture3 - TV1 Picture4  -0.5500 0.492 159.0  -1.118  0.9935
 TV1 Picture3 - TV2 Picture4   1.0188 0.604  51.1   1.687  0.8658
 TV1 Picture3 - TV3 Picture4  -2.6375 0.604  51.1  -4.367  0.0032
 TV2 Picture3 - TV3 Picture3  -0.7312 0.604  51.1  -1.211  0.9857
 TV2 Picture3 - TV1 Picture4  -1.2500 0.604  51.1  -2.070  0.6454
 TV2 Picture3 - TV2 Picture4   0.3187 0.492 159.0   0.648  1.0000
 TV2 Picture3 - TV3 Picture4  -3.3375 0.604  51.1  -5.526  0.0001
 TV3 Picture3 - TV1 Picture4  -0.5188 0.604  51.1  -0.859  0.9992
 TV3 Picture3 - TV2 Picture4   1.0500 0.604  51.1   1.738  0.8418
 TV3 Picture3 - TV3 Picture4  -2.6063 0.492 159.0  -5.297  &lt;.0001
 TV1 Picture4 - TV2 Picture4   1.5688 0.604  51.1   2.597  0.3081
 TV1 Picture4 - TV3 Picture4  -2.0875 0.604  51.1  -3.456  0.0459
 TV2 Picture4 - TV3 Picture4  -3.6562 0.604  51.1  -6.054  &lt;.0001

Degrees-of-freedom method: kenward-roger 
P value adjustment: tukey method for comparing a family of 12 estimates </code></pre>
</div>
</div>
</section>
<section id="checking-model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="checking-model-assumptions">Checking model assumptions</h2>
<p>When we set up random effect terms, these are specified as being normal random variables. This has a <strong>shrinkage effect</strong>: predictions of the random effect model will tend to be closer to the mean than corresponding fixed, more so for larger values. In linear mixed models, we can retrieve predictions of random effects and plot them against theoretical normal plotting positions to see if they are in line with the assumption (as we did for residuals).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice) <span class="co"># plots</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot residuals against fitted value (additivity / linearity)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mmod)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Normal quantile-quantile plot of residuals</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqmath</span>(mmod)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Normal quantile-quantile plots of random effect predictions</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>random <span class="ot">&lt;-</span> <span class="fu">ranef</span>(mmod)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="mixedmodel_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As with other quantile-quantile plots, we expect the values to fall in line, which they seem to do here. There is one residual corresponding to a rating much below the average, but nothing to worry given the large sample size.</p>
</section>
</section>
<section id="example-2" class="level1">
<h1>Example 2</h1>
<p>We consider the data from <span class="citation" data-cites="Curley:2021">Curley et al. (<a href="#ref-Curley:2021" role="doc-biblioref">2022</a>)</span>, who investigate the effect of anchoring and perception in a judicial system having three potential verdicts: guitly, not guilty and not proven.</p>
<p>The authors used a linear mixed effect model</p>
<blockquote class="blockquote">
<p>For the final guilt scores, we conducted linear regressions with pre-trial bias (PJAQ) as a covariate and repeated measures for evidence anchor and vignette. We also included by-subject intercepts as a random effect.</p>
</blockquote>
<section id="model-structure" class="level2">
<h2 class="anchored" data-anchor-id="model-structure">Model structure</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up sum-to-zero constraint for factors</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">"contr.sum"</span>, <span class="st">"contr.poly"</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(C22, <span class="at">package =</span> <span class="st">"hecedsm"</span>) <span class="co"># Load data</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(C22)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [256 × 7] (S3: tbl_df/tbl/data.frame)
 $ anchor     : Factor w/ 2 levels "weak-first","strong-first": 2 2 2 2 2 2 2 2 2 2 ...
 $ vignette   : Factor w/ 2 levels "1","2": 1 1 1 1 1 1 1 1 1 1 ...
 $ id         : Factor w/ 128 levels "1","2","3","4",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ vorder     : Factor w/ 2 levels "1","2": 1 1 1 1 1 1 1 1 1 1 ...
 $ verdictsyst: Factor w/ 2 levels "two","three": 1 1 1 1 1 1 1 1 2 2 ...
 $ guilt      : num [1:256] 103.5 81.8 87.8 82.7 76.8 ...
 $ prior      : num [1:256] 67 101 65 60 75 73 66 86 59 93 ...</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How are conditions manipulated?</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(C22, <span class="fu">xtabs</span>(<span class="sc">~</span> vignette <span class="sc">+</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        id
vignette 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26
       1 1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
       2 1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
        id
vignette 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49
       1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
       2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
        id
vignette 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72
       1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
       2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
        id
vignette 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95
       1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
       2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
        id
vignette 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113
       1  1  1  1  1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
       2  1  1  1  1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
        id
vignette 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128
       1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
       2   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(C22, <span class="fu">xtabs</span>(<span class="sc">~</span> vignette <span class="sc">+</span> anchor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        anchor
vignette weak-first strong-first
       1         64           64
       2         64           64</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(C22, <span class="fu">xtabs</span>(<span class="sc">~</span> anchor <span class="sc">+</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              id
anchor         1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
  weak-first   1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
  strong-first 1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
              id
anchor         25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45
  weak-first    1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
  strong-first  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
              id
anchor         46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66
  weak-first    1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
  strong-first  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
              id
anchor         67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87
  weak-first    1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
  strong-first  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
              id
anchor         88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106
  weak-first    1  1  1  1  1  1  1  1  1  1  1  1   1   1   1   1   1   1   1
  strong-first  1  1  1  1  1  1  1  1  1  1  1  1   1   1   1   1   1   1   1
              id
anchor         107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122
  weak-first     1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
  strong-first   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
              id
anchor         123 124 125 126 127 128
  weak-first     1   1   1   1   1   1
  strong-first   1   1   1   1   1   1</code></pre>
</div>
</div>
<p>For each individual we see each pair of anchor once, but people are assigned to a single vignette. With only two measurements, no interaction is possible within participants. Likewise, we cannot have interaction between subject-effect and with anchor and verdict system (why?)</p>
<p>We thus include a single random effect, that for subject. <span class="citation" data-cites="Curley:2021">Curley et al. (<a href="#ref-Curley:2021" role="doc-biblioref">2022</a>)</span> fitted two models: one with all three way interactions between PJAQ (<code>prior</code>), vignette and anchor, the other with additive effects.</p>
<p>Since PJAQ is a continuous covariate, the interaction with vignette and anchor means that we expect the slope for PJAQ to be different for each group. This isn’t necessarily justified by any of the author’s hypotheses. If any interaction with the total pre-trial bias (PJAQ) is present, we would need to perform comparisons for different values of PJAQ.</p>
</section>
<section id="model-fitting-and-tests" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting-and-tests">Model fitting and tests</h2>
<p>We fit the model without the interaction with PJAQ. Note that, using <code>emmeans</code>, it is better to center the covariate so that it’s average is zero, in which case comparisons are performed for this average value.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>C22_c <span class="ot">&lt;-</span> C22 <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pjaq =</span> <span class="fu">scale</span>(prior, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">guilt =</span> guilt <span class="sc">/</span> <span class="dv">10</span>) </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># scale from 0 to 14</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  guilt <span class="sc">~</span> anchor<span class="sc">*</span>vignette<span class="sc">*</span>pjaq <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> C22_c)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  guilt <span class="sc">~</span> anchor<span class="sc">*</span>vignette <span class="sc">+</span> pjaq <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> C22_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now that we have model coefficients, we can test the models. First, we check if the slope is the same for each of the four subgroups</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Type III ANOVA from lmerTest</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>refitting model(s) with ML (instead of REML)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: C22_c
Models:
model2: guilt ~ anchor * vignette + pjaq + (1 | id)
model1: guilt ~ anchor * vignette * pjaq + (1 | id)
       npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)
model2    7 1114.4 1139.2 -550.22   1100.4                     
model1   10 1119.5 1155.0 -549.77   1099.5 0.8908  3     0.8276</code></pre>
</div>
</div>
<p>There appear to be no two-way or three-way interactions between any of the two factors and the covariate.</p>
<p>We can create an interaction plot to see what the estimated marginal means are for each of the four subconditions when the total pre-trial bias score is average.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction plot</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">emmip</span>(model2, </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> anchor <span class="sc">~</span> vignette, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIs =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mixedmodel_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There seems to be differences, but note the very large uncertainty (and that of difference would be larger than for the individual means). We can inspect the estimated parameters for the model coefficient and compute marginal means.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: guilt ~ anchor * vignette + pjaq + (1 | id)
   Data: C22_c

REML criterion at convergence: 1115.4

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-1.98159 -0.47839  0.02203  0.48593  2.76710 

Random effects:
 Groups   Name        Variance Std.Dev.
 id       (Intercept) 3.472    1.863   
 Residual             2.129    1.459   
Number of obs: 256, groups:  id, 128

Fixed effects:
                   Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)         8.18232    0.18826 125.00000  43.462  &lt; 2e-16 ***
anchor1             0.25008    0.09119 126.00000   2.743  0.00699 ** 
vignette1           0.29655    0.09119 126.00000   3.252  0.00147 ** 
pjaq                0.08231    0.01938 125.00000   4.247  4.2e-05 ***
anchor1:vignette1   0.02823    0.18935 125.00000   0.149  0.88173    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) anchr1 vgntt1 pjaq  
anchor1      0.000                     
vignette1    0.000  0.000              
pjaq         0.000  0.000  0.000       
anchr1:vgn1  0.000  0.000  0.000 -0.107</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(model2, <span class="at">spec =</span> <span class="st">"anchor"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">contrast</span>(<span class="at">method =</span> <span class="st">"pairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: Results may be misleading due to involvement in interactions</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                      estimate    SE  df t.ratio p.value
 (weak-first) - (strong-first)      0.5 0.182 126   2.743  0.0070

Results are averaged over the levels of: vignette 
Degrees-of-freedom method: kenward-roger </code></pre>
</div>
</div>
<p>There is a strong correlation, 0.59 between the responses from the same individuals so failing to account for the subject-specific random effect would lead to misleading conclusions, as reported <span class="math inline">\(p\)</span>-values would be much smaller than they should be.</p>
<p>The correlation between pre-trial bias score (PJAQ) and the guilt score is 0.32. The coefficient in the additive model is 0.08 with a standard error of 0.19, indicating a strong positive effect of pre-trial bias on the guilt score.</p>
<p>The anchor has a large impact, with the estimated difference weak-first vs strong-first of 5 points for the guilt score overall.</p>
</section>
</section>
<section id="example-3" class="level1">
<h1>Example 3</h1>
<p>We consider data from a study at Tech3Lab <span class="citation" data-cites="LabonteLemoyne:2020">(<a href="#ref-LabonteLemoyne:2020" role="doc-biblioref">Labonté-LeMoyne et al., 2020</a>)</span> on standing desks. The description from the abstract reads</p>
<blockquote class="blockquote">
<p>Thirty-seven young and healthy adults performed eight cognitive tasks in a 2 × 2 × 2 within-subject design of the following independent variables: posture (sitting/standing), task difficulty (easy/hard), and input device (computer mouse/tactile screen) in a counterbalanced order.</p>
</blockquote>
<p>The database <code>LJLSFBM20</code> in package <code>hecedsm</code> contains the measurements. There is a total of 296 measurements, or <span class="math inline">\(37 \times 8\)</span>, meaning each participant is assigned to a single task.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(LJLSFBM20, <span class="at">package =</span> <span class="st">"hecedsm"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(LJLSFBM20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [296 × 14] (S3: tbl_df/tbl/data.frame)
 $ id            : Factor w/ 37 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 2 2 ...
 $ order         : int [1:296] 1 2 3 4 5 6 7 8 1 2 ...
 $ position      : Factor w/ 2 levels "standing","sitting": 2 2 2 2 1 1 1 1 1 1 ...
 $ phys_demand   : Factor w/ 2 levels "mouse","touchpad": 1 2 2 1 2 2 1 1 2 2 ...
 $ task_diff     : Factor w/ 2 levels "easy","difficult": 1 2 1 2 2 1 2 1 2 1 ...
 $ ies           : num [1:296] 2486 24034 4691 11727 10874 ...
 $ central_alpha : num [1:296] 0.3 0.227 0.25 0.224 0.235 ...
 $ parietal_alpha: num [1:296] 0.388 0.348 0.345 0.333 0.298 ...
 $ central_beta  : num [1:296] 0.1103 0.0866 0.0902 0.0863 0.0972 ...
 $ parietal_beta : num [1:296] 0.169 0.159 0.141 0.147 0.141 ...
 $ bmi           : num [1:296] 22.8 22.8 22.8 22.8 22.8 ...
 $ sex           : Factor w/ 2 levels "man","woman": 1 1 1 1 1 1 1 1 1 1 ...
 $ attention     : num [1:296] 6.83 6.67 6.83 6.83 6.83 ...
 $ satisfaction  : num [1:296] 70 85 80 76 86 100 60 80 70 85 ...</code></pre>
</div>
</div>
<section id="model-structure-1" class="level2">
<h2 class="anchored" data-anchor-id="model-structure-1">Model structure</h2>
<p>The <code>id</code> variable is a dummy for the participant, with associated covariate <code>sex</code> and <code>bmi</code>. We also have the three within-subject factors, <code>position</code>, <code>phys_demand</code> and <code>task_diff</code> and the <code>order</code> in which the tasks were given (counterbalanced). There are in total seven response variables: the inverse efficiency score global stimulus (<code>ies</code>), measures of brain activity (<code>central_alpha</code>, <code>parietal_alpha</code>, <code>central_beta</code>, <code>parietal_beta</code>) and two scales obtained from answers to a questionaire, <code>attention</code> and <code>satisfaction</code>.</p>
<p>The three manipulated factors are nested within subject and crossed, so we can estimate the three-way and two-way interactions with the experimental factors. The only logical random effect here is for subject, and we cannot have further sources of variability given the lack of replication.</p>
<p>The authors are not transparent as to what their model is and earns a failure grade for reproducibility: we have no idea of the specification, coefficients are not reported. There is clearly 8 coefficiens corresponding to the average of the subgroups, plus a random effect for subject and sex and body mass index as covariates. It appears from the output of Table 1 that there was an interaction term added for BMI and position (as standing may be more strenuous on overweight participants). Finally, we include the order of the tasks as a covariate to account for potential fatigue effects.</p>
</section>
<section id="model-adjustment-and-testing" class="level2">
<h2 class="anchored" data-anchor-id="model-adjustment-and-testing">Model adjustment and testing</h2>
<p>Our linear mixed model would take the form, here with <code>ies</code> as response</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ies <span class="sc">~</span> position<span class="sc">*</span>phys_demand<span class="sc">*</span>task_diff <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> id) <span class="sc">+</span> sex <span class="sc">+</span> bmi<span class="sc">*</span>position <span class="sc">+</span> order, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> LJLSFBM20) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Given the number of response variables and coefficients, it is clear one must account for testing multiplicity. Figuring out the size of the family, <span class="math inline">\(m\)</span>, is not trivial: testing interactions and main effects leads to 7 tests. We could also be interested in the interaction between body mass index and position if it affects performance, bringing the number of tests to 8 and throw the covariate effect for order (up to 11 if we include all controls). Further contrasts may inflate this number (for example, there are 28 pairwise comparisons if the three-way interaction is significant). With seven responses and linear mixed models parametrized in the same way, we have at least 56 tests and potentially up to 350! Controlling the type-I error requires using Bonferroni–Holm type correction, since the different responses are not part of the same models.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Type III Analysis of Variance Table with Satterthwaite's method
                                   Sum Sq    Mean Sq NumDF DenDF  F value
position                           574983     574983     1   250   0.0361
phys_demand                    1280635446 1280635446     1   250  80.3464
task_diff                      4927991208 4927991208     1   250 309.1796
sex                              79185574   79185574     1    34   4.9681
bmi                              10365621   10365621     1    34   0.6503
order                           105580125  105580125     1   250   6.6240
position:phys_demand              9127601    9127601     1   250   0.5727
position:task_diff                1825943    1825943     1   250   0.1146
phys_demand:task_diff           327914741  327914741     1   250  20.5732
position:bmi                      1224778    1224778     1   250   0.0768
position:phys_demand:task_diff    2299196    2299196     1   250   0.1443
                                  Pr(&gt;F)    
position                         0.84952    
phys_demand                    &lt; 2.2e-16 ***
task_diff                      &lt; 2.2e-16 ***
sex                              0.03254 *  
bmi                              0.42560    
order                            0.01064 *  
position:phys_demand             0.44992    
position:task_diff               0.73530    
phys_demand:task_diff          8.913e-06 ***
position:bmi                     0.78185    
position:phys_demand:task_diff   0.70441    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>If we focus on the sole results for <code>ies</code>, there is a significant two-way interaction (and main effects) for <code>phys_demand</code> and <code>task_diff</code>, but not for <code>position</code>. Further investigation would reveal better performance on the easy task and overall with a mouse.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">emmeans</span>(mod, <span class="at">spec =</span> <span class="fu">c</span>(<span class="st">"phys_demand"</span>,<span class="st">"task_diff"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: Results may be misleading due to involvement in interactions</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> phys_demand task_diff emmean  SE   df lower.CL upper.CL
 mouse       easy        2668 672 79.3     1332     4005
 touchpad    easy        4723 672 79.2     3387     6060
 mouse       difficult   8733 672 79.3     7396    10070
 touchpad    difficult  14998 672 79.2    13662    16335

Results are averaged over the levels of: position, sex 
Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 </code></pre>
</div>
</div>
</section>
<section id="model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="model-assumptions">Model assumptions</h2>
<p>One may wonder whether there are any effect of spillover, learning or fatigue due to the repeated measures: tasks were much longer than is typical. The coefficient for <code>order</code> is -268.14, so the decrease for the inverse efficiency score global stimulus for each additional task, <em>ceteris paribus</em>, with a <span class="math inline">\(p\)</span>-value of 0.011 suggesting participants improve over time.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">residuals =</span> <span class="fu">resid</span>(mod), </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">id =</span> LJLSFBM20<span class="sc">$</span>id),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> id, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> residuals)) <span class="sc">+</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">residuals =</span> <span class="fu">resid</span>(mod), </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">order =</span> LJLSFBM20<span class="sc">$</span>order),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> order, </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> residuals)) <span class="sc">+</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combine results</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-residualsvscovariate" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mixedmodel_files/figure-html/fig-residualsvscovariate-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Scatterplots of residuals from the linear mixed model against participant identifier (left) and against order of task (right).</figcaption>
</figure>
</div>
</div>
</div>
<p>Looking at the residuals of the model per participants is also quite insightful. It is clear that measurements from participants 30 and 31 are abnormal, and these correspond to the values we see.</p>
<p>We can check the other model assumptions: the quantile-quantile plot of random effects suggests some large outliers, unsurprisingly due to the participants identified. The plot of fitted values vs residuals suggests our model is wholly inadequate: there is a clear trend in the residuals and strong evidence of heterogeneity.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ranef</span>(mod))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-residualsStanding" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mixedmodel_files/figure-html/fig-residualsStanding-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Normal quantile-quantile plot of predicted random effects (left) and Tukey’s plot of residual vs fitted values (right).</figcaption>
</figure>
</div>
</div>
</div>
<p>We could fit a more complex model to tackle the heterogeneity issue by including different variance per individual, at the expense of lower power.</p>


<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list">
<div id="ref-Curley:2021" class="csl-entry" role="listitem">
Curley, L. J., Murray, J., MacLean, R., Munro, J., Lages, M., Frumkin, L. A., Laybourn, P., &amp; Brown, D. (2022). Verdict spotting: Investigating the effects of juror bias, evidence anchors and verdict system in jurors. <em>Psychiatry, Psychology and Law</em>, <em>29</em>(3), 323–344. <a href="https://doi.org/10.1080/13218719.2021.1904450">https://doi.org/10.1080/13218719.2021.1904450</a>
</div>
<div id="ref-LabonteLemoyne:2020" class="csl-entry" role="listitem">
Labonté-LeMoyne, E., Jutras, M.-A., Léger, P.-M., Sénécal, S., Fredette, M., Begon, M., &amp; Mathieu, M.-È. (2020). Does reducing sedentarity with standing desks hinder cognitive performance? <em>Human Factors</em>, <em>62</em>(4), 603–612. <a href="https://doi.org/10.1177/0018720819879310">https://doi.org/10.1177/0018720819879310</a>
</div>
<div id="ref-sandwich:2020" class="csl-entry" role="listitem">
Zeileis, A., Köll, S., &amp; Graham, N. (2020). Various versatile variances: An object-oriented implementation of clustered covariances in <span>R</span>. <em>Journal of Statistical Software</em>, <em>95</em>(1), 1–36. <a href="https://doi.org/10.18637/jss.v095.i01">https://doi.org/10.18637/jss.v095.i01</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb44" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Linear mixed models"</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="an">type:</span><span class="co"> docs</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r slides-videos, echo=FALSE, include=FALSE}</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">''</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>The following examples serves to illustrate the structure of experimental designs with both crossed and nested effects. The models are fitted specifying both random and fixed effects. We use the **R** package <span class="in">`lme4`</span> to estimate the coefficients of the resulting linear mixed effect model and <span class="in">`lmerTest`</span> for additional testing features.</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>A word of caution: correctly formulating mixed models for complex experimental designs is far from trivial, and the correct interpretation of the output requires subject-matter expertise. Thus, rather than see the following sections as a definitive guide to doing such calculations on your own, it should be viewed as a way to acquire some terminology and intuition for speaking with a statistical consultant and formulating your needs, and gain familiarity for peer-reviewing purposes.</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="fu"># Example 1</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>We consider data from Danish company of electronics Bang and Olufsen from the <span class="in">`lmerTest`</span> package (under <span class="in">`data(TVbo)`</span>). The setup of the experiment is as follows: eight experienced raters (<span class="in">`Assessor`</span>) were asked to rate 15 characteristics of televisions to compare two attributes, <span class="in">`Picture`</span> and <span class="in">`TVset`</span>.</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Determining model structure</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>Based on this description alone, it is somewhat unclear what the structure of the experiment is. We can inspect the database.</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(TVbo)</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(TVbo)</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>We have three factors for the model: <span class="in">`Assessor`</span>, <span class="in">`TVset`</span> and <span class="in">`Picture`</span>. There are seemingly two repetitions for ratings based on the factor level. Let us investigate the two manipulated factors, <span class="in">`TVset`</span> and <span class="in">`Picture`</span>, and look at the number of occurences for each combination</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> TVset <span class="sc">+</span> Picture, <span class="at">data =</span> TVbo)</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>There are 16 measurements for each combination, something compatible with a repeated measure design in which each of the eight assessor gets to see all factors. Thus, <span class="in">`Picture`</span> and <span class="in">`TVset`</span> are crossed within-subject factors and the dataset is balanced.  The contingency table shows that we can estimate interactions between <span class="in">`TVset`</span> and <span class="in">`Picture`</span>. Since we are not interested in individual assessors scores, we treat the factor as a random effect and any interaction with <span class="in">`Assessor`</span> will also be treated as random. </span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>Given that we have two replications per combination of <span class="in">`TVset`</span> and <span class="in">`Picture`</span>, we could in theory fit the three-way (random) effect by including the term <span class="in">`(1 | Assessor:TVset:Picture)`</span>. If we do so, the software gives a warning: <span class="in">`boundary (singular) fit`</span>  which indicates an estimated variance is exactly zero, a synonym in this example for overfitting. We thus remove the three-way interaction. However, the numerical routine fails to converge, showing zero estimated variance for <span class="in">`Assessor:Picture`</span>. Thus, we refit the model without the three-way interaction (since it does not make sense to have a three-way interaction, but remove one of the two-way), and later refit another model without <span class="in">`Assessor:Picture`</span> whose variability is still estimated to be zero. Sometimes, this may be due to poor starting value and we may try to change the default optimization algorithm, the problem persist. </span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model formulation</span></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>Since there are 15 different response variables, we start with a single one, here <span class="in">`Sharpness`</span> of the display. The model we fit is of the form</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>Y_{ijkl} = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \gamma_k + (\beta\gamma)_{jk} + \varepsilon_{ijkl},</span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>where</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Y_{ijkl}$ is the <span class="in">`Sharpness`</span> rating for the $i$th <span class="in">`TVset`</span>, the $j$th <span class="in">`Picture`</span>, the $k$th assessor and the $l$th replication.</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mu$ is the global average of all ratings</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\alpha_i$ is the mean different for the $i$th <span class="in">`TVset`</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_j$ is the mean different for the $j$th <span class="in">`Picture`</span></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$(\alpha\beta)_{ij}$ is the interaction for the $i$th <span class="in">`TVset`</span> and $j$th <span class="in">`Picture`</span>.</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\gamma_k \sim \mathsf{No}(0, \sigma^2_\gamma)$ is the random effect of assessors</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$(\alpha\gamma)_{ik} \sim \mathsf{No}(0, \sigma^2_{\alpha\gamma})$ are random effects for assessors for television sets</span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\varepsilon_{ijkl} \sim \mathsf{No}(0, \sigma^2_\varepsilon)$ are measurements-specific error terms</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>All of the random effects, including error, are independent of one another.</span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>mmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>  Sharpness <span class="sc">~</span> TVset <span class="sc">*</span> Picture <span class="sc">+</span> </span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>       (<span class="dv">1</span> <span class="sc">|</span> Assessor) <span class="sc">+</span> </span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a>       <span class="co"># (1 | Assessor:Picture) +</span></span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>       <span class="co"># (1 | Assessor:TVset:Picture) +</span></span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a>       (<span class="dv">1</span> <span class="sc">|</span> Assessor<span class="sc">:</span>TVset) ,</span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># control = lmerControl(optimizer = "bobyqa"),</span></span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 'control' above for the optimization routine</span></span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> TVbo)</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mmod)</span></span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a><span class="fu">## Correlation structure</span></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a>The first section of the summary table gives estimations of the standard deviation of each error term. There is little variability due to <span class="in">`Assessor:Picture`</span> interaction. The most important part of this output is perhaps to look at the number of instances to make sure our design specification is correct. The model assumes (correctly) that there are 32 combinations of <span class="in">`Assessor`</span> and <span class="in">`Picture`</span> (8 by 4), 24 combinations of <span class="in">`Assessor`</span> and <span class="in">`TVset`</span> (8 by 3) and 8 combinations for <span class="in">`Assessor`</span>. </span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a><span class="in">Random effects:</span></span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a><span class="in"> Groups         Name        Variance Std.Dev.</span></span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a><span class="in"> Assessor:TVset (Intercept) 0.4909   0.7006  </span></span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a><span class="in"> Assessor       (Intercept) 1.0837   1.0410  </span></span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a><span class="in"> Residual                   1.9366   1.3916  </span></span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a><span class="in">Number of obs: 192, groups:  </span></span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a><span class="in">Assessor:TVset, 24; Assessor, 8</span></span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a>One of the main reason for using mixed models is to automatically account for the correlation between observations. If we fail to account for the dependence between ratings from the same assessor and their personal preferences, we will get standard errors for the estimated mean difference for the two fixed effect that are **too small**. Another popular option in finance and economics is use of so-called sandwich variance estimators to handle unequal variance and clustering. Among other, the [`sandwich`](https://doi.org/10.18637/jss.v095.i01) package in **R** <span class="co">[</span><span class="ot">@sandwich:2020</span><span class="co">]</span> offers multiple options should one decide on this avenue.</span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a>@fig-tvbocorr shows the structure of the correlation matrix of the ratings: the blocks corresponds to the eight assessors: measurements from different assessors are independent, but they are correlated within assessors as a result of specifying (multiple) random effects with assessors. Since there is more than one source of variability here, the pattern is different from equicorrelation, with additional correlations between if data are from the same TV set or same picture level.</span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Correlation structure for the linear mixed model fitted to the `TVbo` data"</span></span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tvbocorr</span></span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a>rescov <span class="ot">&lt;-</span> hecstatmod<span class="sc">::</span><span class="fu">rescov</span>(mmod)</span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rescov)</span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a><span class="fu">## Testing</span></span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a>Before looking more in details at the output, let us see if the rating depends on the setting (<span class="in">`TVset`</span> and <span class="in">`Picture`</span> combination): if it did, we would have to basically compare all 12 combinations as a one-way analysis of variance model. In this context, the logical comparison would be to compute pairwise differences and check which are equivalent to the best combination.</span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-125"><a href="#cb44-125" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mmod, <span class="at">ddf =</span> <span class="st">"Kenward-Roger"</span>)</span>
<span id="cb44-126"><a href="#cb44-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-128"><a href="#cb44-128" aria-hidden="true" tabindex="-1"></a>It is clear that there are differences all across the board. Constructing tests for mixed models in general is complicated and we need to correctly set up the model and compare the variability of the differences relative to the mean for each factor relative to different measures of variability. These will be the next random term that includes this factor and random effects (here either <span class="in">`Assessor`</span> or the <span class="in">`Error`</span> term). The correct source of variability are <span class="in">`Assessor:TVset`</span> for <span class="in">`TVset`</span>, <span class="in">`Assessor:Picture`</span> for <span class="in">`Picture`</span> and the error term for the two-way interaction between both fixed effects. Likewise, the degrees of freedom for the denominator are determined by the number of instances of the random term that involves the factor, so $8 \times 3 - (1 - 2 - 7) = 14$ degrees of freedom since there are 24 instances of <span class="in">`TVset:Assessor`</span> and we have to estimate one grand mean, two mean differences for <span class="in">`TVset`</span> and likewise 7 effects for the <span class="in">`Assessor`</span>.</span>
<span id="cb44-129"><a href="#cb44-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-130"><a href="#cb44-130" aria-hidden="true" tabindex="-1"></a>This decomposition is better seen looking directly at the model output when fitted using <span class="in">`aov`</span> (since this is a balanced within-subject design).</span>
<span id="cb44-131"><a href="#cb44-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-134"><a href="#cb44-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-135"><a href="#cb44-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-136"><a href="#cb44-136" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb44-137"><a href="#cb44-137" aria-hidden="true" tabindex="-1"></a>  Coloursaturation <span class="sc">~</span> TVset <span class="sc">*</span> Picture <span class="sc">+</span></span>
<span id="cb44-138"><a href="#cb44-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Error</span>(Assessor<span class="sc">/</span>(Picture<span class="sc">*</span>TVset)), </span>
<span id="cb44-139"><a href="#cb44-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> TVbo)</span>
<span id="cb44-140"><a href="#cb44-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-141"><a href="#cb44-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-142"><a href="#cb44-142" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pairwise comparisons</span></span>
<span id="cb44-143"><a href="#cb44-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-144"><a href="#cb44-144" aria-hidden="true" tabindex="-1"></a>We can next look at the estimated marginal means to find the television sets and the picture with the best ratings. </span>
<span id="cb44-147"><a href="#cb44-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-148"><a href="#cb44-148" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb44-149"><a href="#cb44-149" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> mmod <span class="sc">|&gt;</span> </span>
<span id="cb44-150"><a href="#cb44-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">emmeans</span>(<span class="at">spec =</span> <span class="fu">c</span>(<span class="st">"TVset"</span>,<span class="st">"Picture"</span>))</span>
<span id="cb44-151"><a href="#cb44-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-152"><a href="#cb44-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-153"><a href="#cb44-153" aria-hidden="true" tabindex="-1"></a>All four best ratings are for TV set 2, with picture 4, 1, 2 and 3 (in decreasing order). We can see if these differences are significant by looking at all pairwise differences between combinations to find the best value. All of the differences in rating for TV set 2 could be attributed to noise after correcting for multiple testing using Tukey's correction. The fifth top position is TV set 1, picture 4 and this one has a significantly lower rating (adjusted $p$-value of 0.0088) than the leading choice.</span>
<span id="cb44-154"><a href="#cb44-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-155"><a href="#cb44-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-158"><a href="#cb44-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-159"><a href="#cb44-159" aria-hidden="true" tabindex="-1"></a>emm</span>
<span id="cb44-160"><a href="#cb44-160" aria-hidden="true" tabindex="-1"></a>emm <span class="sc">|&gt;</span> </span>
<span id="cb44-161"><a href="#cb44-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairs</span>()</span>
<span id="cb44-162"><a href="#cb44-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-163"><a href="#cb44-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-164"><a href="#cb44-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-165"><a href="#cb44-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-166"><a href="#cb44-166" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking model assumptions</span></span>
<span id="cb44-167"><a href="#cb44-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-168"><a href="#cb44-168" aria-hidden="true" tabindex="-1"></a>When we set up random effect terms, these are specified as being normal random variables. This has a **shrinkage effect**: predictions of the random effect model will tend to be closer to the mean than corresponding fixed, more so for larger values. In linear mixed models, we can retrieve predictions of random effects and plot them against theoretical normal plotting positions to see if they are in line with the assumption (as we did for residuals).</span>
<span id="cb44-169"><a href="#cb44-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-170"><a href="#cb44-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-173"><a href="#cb44-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-174"><a href="#cb44-174" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-175"><a href="#cb44-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb44-176"><a href="#cb44-176" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice) <span class="co"># plots</span></span>
<span id="cb44-177"><a href="#cb44-177" aria-hidden="true" tabindex="-1"></a><span class="co"># plot residuals against fitted value (additivity / linearity)</span></span>
<span id="cb44-178"><a href="#cb44-178" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mmod)</span>
<span id="cb44-179"><a href="#cb44-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Normal quantile-quantile plot of residuals</span></span>
<span id="cb44-180"><a href="#cb44-180" aria-hidden="true" tabindex="-1"></a><span class="fu">qqmath</span>(mmod)</span>
<span id="cb44-181"><a href="#cb44-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Normal quantile-quantile plots of random effect predictions</span></span>
<span id="cb44-182"><a href="#cb44-182" aria-hidden="true" tabindex="-1"></a>random <span class="ot">&lt;-</span> <span class="fu">ranef</span>(mmod)</span>
<span id="cb44-183"><a href="#cb44-183" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random)</span>
<span id="cb44-184"><a href="#cb44-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-185"><a href="#cb44-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-188"><a href="#cb44-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-189"><a href="#cb44-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-190"><a href="#cb44-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb44-191"><a href="#cb44-191" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb44-192"><a href="#cb44-192" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="fu">ranef</span>(mmod))</span>
<span id="cb44-193"><a href="#cb44-193" aria-hidden="true" tabindex="-1"></a>plots[[<span class="dv">1</span>]]<span class="sc">$</span>xlab <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"normal plotting positions"</span>)</span>
<span id="cb44-194"><a href="#cb44-194" aria-hidden="true" tabindex="-1"></a>plots[[<span class="dv">2</span>]]<span class="sc">$</span>xlab <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"normal plotting positions"</span>)</span>
<span id="cb44-195"><a href="#cb44-195" aria-hidden="true" tabindex="-1"></a>plots[[<span class="dv">1</span>]]<span class="sc">$</span>ylab <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"random effects"</span>)</span>
<span id="cb44-196"><a href="#cb44-196" aria-hidden="true" tabindex="-1"></a>plots[[<span class="dv">2</span>]]<span class="sc">$</span>ylab <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"random effects"</span>)</span>
<span id="cb44-197"><a href="#cb44-197" aria-hidden="true" tabindex="-1"></a>plots[[<span class="dv">1</span>]]<span class="sc">$</span>xlab.top <span class="ot">&lt;-</span> <span class="st">"(Assessor:TVset)"</span></span>
<span id="cb44-198"><a href="#cb44-198" aria-hidden="true" tabindex="-1"></a>plots[[<span class="dv">2</span>]]<span class="sc">$</span>xlab.top <span class="ot">&lt;-</span> <span class="st">"(Assessor:TVset)"</span></span>
<span id="cb44-199"><a href="#cb44-199" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">qqmath</span>(mmod), <span class="at">split =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>,<span class="dv">2</span>), <span class="at">more =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-200"><a href="#cb44-200" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot</span>(mmod, <span class="at">xlab =</span> <span class="st">"fitted values"</span>, <span class="at">ylab =</span> <span class="st">"residuals"</span>), <span class="at">split =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">more =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-201"><a href="#cb44-201" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plots[[<span class="dv">1</span>]], <span class="at">split =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">more =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-202"><a href="#cb44-202" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plots[[<span class="dv">2</span>]], <span class="at">split =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">more =</span> <span class="cn">FALSE</span>)</span>
<span id="cb44-203"><a href="#cb44-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-204"><a href="#cb44-204" aria-hidden="true" tabindex="-1"></a>As with other quantile-quantile plots, we expect the values to fall in line, which they seem to do here. There is one residual corresponding to a rating much below the average, but nothing to worry given the large sample size.</span>
<span id="cb44-205"><a href="#cb44-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-206"><a href="#cb44-206" aria-hidden="true" tabindex="-1"></a><span class="fu"># Example 2</span></span>
<span id="cb44-207"><a href="#cb44-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-208"><a href="#cb44-208" aria-hidden="true" tabindex="-1"></a>We consider the data from @Curley:2021, who investigate the effect of anchoring and perception in a judicial system having three potential verdicts: guitly, not guilty and not proven. </span>
<span id="cb44-209"><a href="#cb44-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-210"><a href="#cb44-210" aria-hidden="true" tabindex="-1"></a>The authors used a linear mixed effect model </span>
<span id="cb44-211"><a href="#cb44-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-212"><a href="#cb44-212" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; For the final guilt scores, we conducted linear regressions with pre-trial bias (PJAQ) as a covariate and repeated measures for evidence anchor and vignette. We also included by-subject intercepts as a random effect.</span></span>
<span id="cb44-213"><a href="#cb44-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-214"><a href="#cb44-214" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model structure</span></span>
<span id="cb44-215"><a href="#cb44-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-218"><a href="#cb44-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-219"><a href="#cb44-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb44-220"><a href="#cb44-220" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb44-221"><a href="#cb44-221" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb44-222"><a href="#cb44-222" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb44-223"><a href="#cb44-223" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up sum-to-zero constraint for factors</span></span>
<span id="cb44-224"><a href="#cb44-224" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">"contr.sum"</span>, <span class="st">"contr.poly"</span>))</span>
<span id="cb44-225"><a href="#cb44-225" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(C22, <span class="at">package =</span> <span class="st">"hecedsm"</span>) <span class="co"># Load data</span></span>
<span id="cb44-226"><a href="#cb44-226" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(C22)</span>
<span id="cb44-227"><a href="#cb44-227" aria-hidden="true" tabindex="-1"></a><span class="co"># How are conditions manipulated?</span></span>
<span id="cb44-228"><a href="#cb44-228" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(C22, <span class="fu">xtabs</span>(<span class="sc">~</span> vignette <span class="sc">+</span> id))</span>
<span id="cb44-229"><a href="#cb44-229" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(C22, <span class="fu">xtabs</span>(<span class="sc">~</span> vignette <span class="sc">+</span> anchor))</span>
<span id="cb44-230"><a href="#cb44-230" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(C22, <span class="fu">xtabs</span>(<span class="sc">~</span> anchor <span class="sc">+</span> id))</span>
<span id="cb44-231"><a href="#cb44-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-232"><a href="#cb44-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-233"><a href="#cb44-233" aria-hidden="true" tabindex="-1"></a>For each individual we see each pair of anchor once, but people are assigned to a single vignette. With only two measurements, no interaction is possible within participants. Likewise, we cannot have interaction between subject-effect and with anchor and verdict system (why?)</span>
<span id="cb44-234"><a href="#cb44-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-235"><a href="#cb44-235" aria-hidden="true" tabindex="-1"></a>We thus include a single random effect, that for subject. @Curley:2021 fitted two models: one with all three way interactions between PJAQ (<span class="in">`prior`</span>), vignette and anchor, the other with additive effects. </span>
<span id="cb44-236"><a href="#cb44-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-237"><a href="#cb44-237" aria-hidden="true" tabindex="-1"></a>Since PJAQ is a continuous covariate, the interaction with vignette and anchor means that we expect the slope for PJAQ to be different for each group. This isn't necessarily justified by any of the author's hypotheses. If any interaction with the total pre-trial bias (PJAQ) is present, we would need to perform comparisons for different values of PJAQ. </span>
<span id="cb44-238"><a href="#cb44-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-239"><a href="#cb44-239" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model fitting and tests</span></span>
<span id="cb44-240"><a href="#cb44-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-241"><a href="#cb44-241" aria-hidden="true" tabindex="-1"></a>We fit the model without the interaction with PJAQ. Note that, using <span class="in">`emmeans`</span>, it is better to center the covariate so that it's average is zero, in which case comparisons are performed for this average value.</span>
<span id="cb44-242"><a href="#cb44-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-245"><a href="#cb44-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-246"><a href="#cb44-246" aria-hidden="true" tabindex="-1"></a>C22_c <span class="ot">&lt;-</span> C22 <span class="sc">|&gt;</span></span>
<span id="cb44-247"><a href="#cb44-247" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pjaq =</span> <span class="fu">scale</span>(prior, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb44-248"><a href="#cb44-248" aria-hidden="true" tabindex="-1"></a>                <span class="at">guilt =</span> guilt <span class="sc">/</span> <span class="dv">10</span>) </span>
<span id="cb44-249"><a href="#cb44-249" aria-hidden="true" tabindex="-1"></a><span class="co"># scale from 0 to 14</span></span>
<span id="cb44-250"><a href="#cb44-250" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb44-251"><a href="#cb44-251" aria-hidden="true" tabindex="-1"></a>  guilt <span class="sc">~</span> anchor<span class="sc">*</span>vignette<span class="sc">*</span>pjaq <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id),</span>
<span id="cb44-252"><a href="#cb44-252" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> C22_c)</span>
<span id="cb44-253"><a href="#cb44-253" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb44-254"><a href="#cb44-254" aria-hidden="true" tabindex="-1"></a>  guilt <span class="sc">~</span> anchor<span class="sc">*</span>vignette <span class="sc">+</span> pjaq <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id),</span>
<span id="cb44-255"><a href="#cb44-255" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> C22_c)</span>
<span id="cb44-256"><a href="#cb44-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-257"><a href="#cb44-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-258"><a href="#cb44-258" aria-hidden="true" tabindex="-1"></a>Now that we have model coefficients, we can test the models. First, we check if the slope is the same for each of the four subgroups</span>
<span id="cb44-259"><a href="#cb44-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-262"><a href="#cb44-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-263"><a href="#cb44-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Type III ANOVA from lmerTest</span></span>
<span id="cb44-264"><a href="#cb44-264" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span>
<span id="cb44-265"><a href="#cb44-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-266"><a href="#cb44-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-267"><a href="#cb44-267" aria-hidden="true" tabindex="-1"></a>There appear to be no two-way or three-way interactions between any of the two factors and the covariate.</span>
<span id="cb44-268"><a href="#cb44-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-269"><a href="#cb44-269" aria-hidden="true" tabindex="-1"></a>We can create an interaction plot to see what the estimated marginal means are for each of the four subconditions when the total pre-trial bias score is average. </span>
<span id="cb44-270"><a href="#cb44-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-273"><a href="#cb44-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-274"><a href="#cb44-274" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb44-275"><a href="#cb44-275" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction plot</span></span>
<span id="cb44-276"><a href="#cb44-276" aria-hidden="true" tabindex="-1"></a><span class="fu">emmip</span>(model2, </span>
<span id="cb44-277"><a href="#cb44-277" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> anchor <span class="sc">~</span> vignette, </span>
<span id="cb44-278"><a href="#cb44-278" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIs =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb44-279"><a href="#cb44-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb44-280"><a href="#cb44-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb44-281"><a href="#cb44-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-282"><a href="#cb44-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-283"><a href="#cb44-283" aria-hidden="true" tabindex="-1"></a>There seems to be differences, but note the very large uncertainty (and that of difference would be larger than for the individual means). We can inspect the estimated parameters for the model coefficient and compute marginal means.</span>
<span id="cb44-284"><a href="#cb44-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-287"><a href="#cb44-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-288"><a href="#cb44-288" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span>
<span id="cb44-289"><a href="#cb44-289" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(model2, <span class="at">spec =</span> <span class="st">"anchor"</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-290"><a href="#cb44-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">contrast</span>(<span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb44-291"><a href="#cb44-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-292"><a href="#cb44-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-293"><a href="#cb44-293" aria-hidden="true" tabindex="-1"></a>There is a strong correlation, <span class="in">`r round(330.0/(330.0 + 227.1), 2)`</span> between the responses from the same individuals so failing to account for the subject-specific random effect would lead to misleading conclusions, as reported $p$-values would be much smaller than they should be.</span>
<span id="cb44-294"><a href="#cb44-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-295"><a href="#cb44-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-296"><a href="#cb44-296" aria-hidden="true" tabindex="-1"></a>The correlation between pre-trial bias score (PJAQ) and the guilt score is <span class="in">`r round(with(C22, cor(prior,guilt)),2)`</span>. The coefficient in the additive model is <span class="in">`r round(as.numeric(fixef(model2)['pjaq']), 2)`</span> with a standard error of 0.19, indicating a strong positive effect of pre-trial bias on the guilt score.</span>
<span id="cb44-297"><a href="#cb44-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-298"><a href="#cb44-298" aria-hidden="true" tabindex="-1"></a>The anchor has a large impact, with the estimated difference weak-first vs strong-first of 5 points for the guilt score overall.</span>
<span id="cb44-299"><a href="#cb44-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-300"><a href="#cb44-300" aria-hidden="true" tabindex="-1"></a><span class="fu"># Example 3</span></span>
<span id="cb44-301"><a href="#cb44-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-302"><a href="#cb44-302" aria-hidden="true" tabindex="-1"></a>We consider data from a study at Tech3Lab <span class="co">[</span><span class="ot">@LabonteLemoyne:2020</span><span class="co">]</span> on standing desks. The description from the abstract reads</span>
<span id="cb44-303"><a href="#cb44-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-304"><a href="#cb44-304" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Thirty-seven young and healthy adults performed eight cognitive tasks in a 2 × 2 × 2 within-subject design of the following independent variables: posture (sitting/standing), task difficulty (easy/hard), and input device (computer mouse/tactile screen) in a counterbalanced order.</span></span>
<span id="cb44-305"><a href="#cb44-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-306"><a href="#cb44-306" aria-hidden="true" tabindex="-1"></a>The database <span class="in">`LJLSFBM20`</span> in package <span class="in">`hecedsm`</span> contains the measurements. There is a total of <span class="in">`r 37*8`</span> measurements, or $37 \times 8$, meaning each participant is assigned to a single task. </span>
<span id="cb44-307"><a href="#cb44-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-310"><a href="#cb44-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-311"><a href="#cb44-311" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(LJLSFBM20, <span class="at">package =</span> <span class="st">"hecedsm"</span>)</span>
<span id="cb44-312"><a href="#cb44-312" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(LJLSFBM20)</span>
<span id="cb44-313"><a href="#cb44-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-314"><a href="#cb44-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-315"><a href="#cb44-315" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model structure</span></span>
<span id="cb44-316"><a href="#cb44-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-317"><a href="#cb44-317" aria-hidden="true" tabindex="-1"></a>The <span class="in">`id`</span> variable is a dummy for the participant, with associated covariate <span class="in">`sex`</span> and <span class="in">`bmi`</span>. We also have the three within-subject factors, <span class="in">`position`</span>, <span class="in">`phys_demand`</span> and <span class="in">`task_diff`</span> and the <span class="in">`order`</span> in which the tasks were given (counterbalanced). There are in total seven response variables: the inverse efficiency score global stimulus (<span class="in">`ies`</span>), measures of brain activity (<span class="in">`central_alpha`</span>, <span class="in">`parietal_alpha`</span>, <span class="in">`central_beta`</span>, <span class="in">`parietal_beta`</span>) and two scales obtained from answers to a questionaire, <span class="in">`attention`</span> and <span class="in">`satisfaction`</span>. </span>
<span id="cb44-318"><a href="#cb44-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-319"><a href="#cb44-319" aria-hidden="true" tabindex="-1"></a>The three manipulated factors are nested within subject and crossed, so we can estimate the three-way and two-way interactions with the experimental factors. The only logical random effect here is for subject, and we cannot have further sources of variability given the lack of replication.</span>
<span id="cb44-320"><a href="#cb44-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-321"><a href="#cb44-321" aria-hidden="true" tabindex="-1"></a>The authors are not transparent as to what their model is and earns a failure grade for reproducibility: we have no idea of the specification, coefficients are not reported. There is clearly 8 coefficiens corresponding to the average of the subgroups, plus a random effect for subject and sex and body mass index as covariates. It appears from the output of Table 1 that there was an interaction term added for BMI and position (as standing may be more strenuous on overweight participants). Finally, we include the order of the tasks as a covariate to account for potential fatigue effects.</span>
<span id="cb44-322"><a href="#cb44-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-323"><a href="#cb44-323" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model adjustment and testing</span></span>
<span id="cb44-324"><a href="#cb44-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-325"><a href="#cb44-325" aria-hidden="true" tabindex="-1"></a>Our linear mixed model would take the form, here with <span class="in">`ies`</span> as response</span>
<span id="cb44-326"><a href="#cb44-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-329"><a href="#cb44-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-330"><a href="#cb44-330" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb44-331"><a href="#cb44-331" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ies <span class="sc">~</span> position<span class="sc">*</span>phys_demand<span class="sc">*</span>task_diff <span class="sc">+</span></span>
<span id="cb44-332"><a href="#cb44-332" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> id) <span class="sc">+</span> sex <span class="sc">+</span> bmi<span class="sc">*</span>position <span class="sc">+</span> order, </span>
<span id="cb44-333"><a href="#cb44-333" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> LJLSFBM20) </span>
<span id="cb44-334"><a href="#cb44-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-335"><a href="#cb44-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-336"><a href="#cb44-336" aria-hidden="true" tabindex="-1"></a>Given the number of response variables and coefficients, it is clear one must account for testing multiplicity. Figuring out the size of the family, $m$, is not trivial: testing interactions and main effects leads to 7 tests. We could also be interested in the interaction between body mass index and position if it affects performance, bringing the number of tests to 8 and throw the covariate effect for order (up to 11 if we include all controls). Further contrasts may inflate this number (for example, there are 28 pairwise comparisons if the three-way interaction is significant). With seven responses and linear mixed models parametrized in the same way, we have at least 56 tests and potentially up to 350! Controlling the type-I error requires using Bonferroni--Holm type correction, since the different responses are not part of the same models.</span>
<span id="cb44-337"><a href="#cb44-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-338"><a href="#cb44-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-341"><a href="#cb44-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-342"><a href="#cb44-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb44-343"><a href="#cb44-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb44-344"><a href="#cb44-344" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod)</span>
<span id="cb44-345"><a href="#cb44-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-346"><a href="#cb44-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-347"><a href="#cb44-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-348"><a href="#cb44-348" aria-hidden="true" tabindex="-1"></a>If we focus on the sole results for <span class="in">`ies`</span>, there is a significant two-way interaction (and main effects) for <span class="in">`phys_demand`</span> and <span class="in">`task_diff`</span>, but not for <span class="in">`position`</span>. Further investigation would reveal better performance on the easy task and overall with a mouse.</span>
<span id="cb44-349"><a href="#cb44-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-352"><a href="#cb44-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-353"><a href="#cb44-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb44-354"><a href="#cb44-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb44-355"><a href="#cb44-355" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">emmeans</span>(mod, <span class="at">spec =</span> <span class="fu">c</span>(<span class="st">"phys_demand"</span>,<span class="st">"task_diff"</span>))</span>
<span id="cb44-356"><a href="#cb44-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-357"><a href="#cb44-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-358"><a href="#cb44-358" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model assumptions</span></span>
<span id="cb44-359"><a href="#cb44-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-360"><a href="#cb44-360" aria-hidden="true" tabindex="-1"></a>One may wonder whether there are any effect of spillover, learning or fatigue due to the repeated measures: tasks were much longer than is typical. The coefficient for <span class="in">`order`</span> is <span class="in">`r round(as.numeric(fixef(mod)['order']), 2)`</span>, so the decrease for the inverse efficiency score global stimulus for each additional task, *ceteris paribus*, with a $p$-value of <span class="in">`r round(anova(mod)[6,6], 3)`</span> suggesting participants improve over time.</span>
<span id="cb44-361"><a href="#cb44-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-362"><a href="#cb44-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-365"><a href="#cb44-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-366"><a href="#cb44-366" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residualsvscovariate</span></span>
<span id="cb44-367"><a href="#cb44-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Scatterplots of residuals from the linear mixed model against participant identifier (left) and against order of task (right)."</span></span>
<span id="cb44-368"><a href="#cb44-368" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb44-369"><a href="#cb44-369" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb44-370"><a href="#cb44-370" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">residuals =</span> <span class="fu">resid</span>(mod), </span>
<span id="cb44-371"><a href="#cb44-371" aria-hidden="true" tabindex="-1"></a>                    <span class="at">id =</span> LJLSFBM20<span class="sc">$</span>id),</span>
<span id="cb44-372"><a href="#cb44-372" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> id, </span>
<span id="cb44-373"><a href="#cb44-373" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> residuals)) <span class="sc">+</span> </span>
<span id="cb44-374"><a href="#cb44-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-375"><a href="#cb44-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb44-376"><a href="#cb44-376" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb44-377"><a href="#cb44-377" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">residuals =</span> <span class="fu">resid</span>(mod), </span>
<span id="cb44-378"><a href="#cb44-378" aria-hidden="true" tabindex="-1"></a>                    <span class="at">order =</span> LJLSFBM20<span class="sc">$</span>order),</span>
<span id="cb44-379"><a href="#cb44-379" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> order, </span>
<span id="cb44-380"><a href="#cb44-380" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> residuals)) <span class="sc">+</span> </span>
<span id="cb44-381"><a href="#cb44-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-382"><a href="#cb44-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb44-383"><a href="#cb44-383" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combine results</span></span>
<span id="cb44-384"><a href="#cb44-384" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span>
<span id="cb44-385"><a href="#cb44-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-386"><a href="#cb44-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-387"><a href="#cb44-387" aria-hidden="true" tabindex="-1"></a>Looking at the residuals of the model per participants is also quite insightful. It is clear that measurements from participants 30 and 31 are abnormal, and these correspond to the values we see.</span>
<span id="cb44-388"><a href="#cb44-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-389"><a href="#cb44-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-390"><a href="#cb44-390" aria-hidden="true" tabindex="-1"></a>We can check the other model assumptions: the quantile-quantile plot of random effects suggests some large outliers, unsurprisingly due to the participants identified. The plot of fitted values vs residuals suggests our model is wholly inadequate: there is a clear trend in the residuals and strong evidence of heterogeneity.</span>
<span id="cb44-391"><a href="#cb44-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-394"><a href="#cb44-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-395"><a href="#cb44-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-396"><a href="#cb44-396" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb44-397"><a href="#cb44-397" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ranef</span>(mod))</span>
<span id="cb44-398"><a href="#cb44-398" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span>
<span id="cb44-399"><a href="#cb44-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-400"><a href="#cb44-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-403"><a href="#cb44-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-404"><a href="#cb44-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residualsStanding</span></span>
<span id="cb44-405"><a href="#cb44-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Normal quantile-quantile plot of predicted random effects (left) and Tukey's plot of residual vs fitted values (right)."</span></span>
<span id="cb44-406"><a href="#cb44-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb44-407"><a href="#cb44-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-408"><a href="#cb44-408" aria-hidden="true" tabindex="-1"></a><span class="co"># g1 &lt;- car::qqPlot(unlist(ranef(mod)), </span></span>
<span id="cb44-409"><a href="#cb44-409" aria-hidden="true" tabindex="-1"></a><span class="co">#                   id = FALSE, </span></span>
<span id="cb44-410"><a href="#cb44-410" aria-hidden="true" tabindex="-1"></a><span class="co">#                   xlab = "theoretical normal quantile", </span></span>
<span id="cb44-411"><a href="#cb44-411" aria-hidden="true" tabindex="-1"></a><span class="co">#                   ylab = "observed quantile")</span></span>
<span id="cb44-412"><a href="#cb44-412" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="fu">ranef</span>(mod))</span>
<span id="cb44-413"><a href="#cb44-413" aria-hidden="true" tabindex="-1"></a>g1[[<span class="dv">1</span>]]<span class="sc">$</span>xlab <span class="ot">&lt;-</span> <span class="st">"theoretical normal quantile"</span></span>
<span id="cb44-414"><a href="#cb44-414" aria-hidden="true" tabindex="-1"></a>g1[[<span class="dv">1</span>]]<span class="sc">$</span>ylab <span class="ot">&lt;-</span> <span class="st">"observed quantile"</span></span>
<span id="cb44-415"><a href="#cb44-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-416"><a href="#cb44-416" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(mod)</span>
<span id="cb44-417"><a href="#cb44-417" aria-hidden="true" tabindex="-1"></a>g2<span class="sc">$</span>xlab <span class="ot">&lt;-</span> <span class="st">"fitted values"</span></span>
<span id="cb44-418"><a href="#cb44-418" aria-hidden="true" tabindex="-1"></a>g2<span class="sc">$</span>ylab <span class="ot">&lt;-</span> <span class="st">"residuals"</span></span>
<span id="cb44-419"><a href="#cb44-419" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(g1[[<span class="dv">1</span>]], g2,</span>
<span id="cb44-420"><a href="#cb44-420" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb44-421"><a href="#cb44-421" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="sc">-</span> <span class="fl">1.5</span>)</span>
<span id="cb44-422"><a href="#cb44-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-423"><a href="#cb44-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-424"><a href="#cb44-424" aria-hidden="true" tabindex="-1"></a>We could fit a more complex model to tackle the heterogeneity issue by including different variance per individual, at the expense of lower power.</span>
<span id="cb44-425"><a href="#cb44-425" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content <i class="fa-brands fa-creative-commons" aria-hidden="true"></i> 2021-2024 by <a href="https://www.lbelzile.bitbucket.io">Léo Belzile</a>, Website template by <a href="https://www.andrewheiss.com/">Dr.&nbsp;Andrew Heiss</a> under <a href="https://mit-license.org/">MIT License</a><br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-hidden="true"></i> <i class="fa-brands fa-creative-commons-by" aria-hidden="true"></i> <i class="fa-brands fa-creative-commons-nc" aria-hidden="true"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Made with <i class="fa-brands fa-r-project" aria-hidden="true"></i> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/lbelzile/experimental">View the source at <i class="fa-brands fa-github" aria-hidden="true"></i> GitHub</a></div>
  </div>
</footer>



</body></html>